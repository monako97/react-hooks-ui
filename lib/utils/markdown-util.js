"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;Object.defineProperty(o,k2,{enumerable:true,get:function(){return m[k]}})}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};Object.defineProperty(exports,"__esModule",{value:true});var marked_1=__importStar(require("marked"));var escapedText=function(text){return text.toLowerCase().replace(/[^\w]+/g,"-")};var tocObj={add:function(anchor,text,level){this.toc.push({anchor:anchor,level:level,text:text});return anchor},toHTML:function(){var levelStack=[];var hei=-(this.index+2)*1.5+"rem";var result="";var addStartUL=function(){if(!result.trim().length){result+='<ul style="--toc-height: '+hei+';" class="monako__markdown-toc">'}else{result+="<ul>"}};var addEndUL=function(){result+="</ul>\n"};var addLI=function(anchor,text){result+='<li><a href="#'+anchor+'">'+text+"</a></li>\n"};this.toc.forEach(function(item){var levelIndex=levelStack.indexOf(item.level);if(levelIndex===-1){levelStack.unshift(item.level);addStartUL();addLI(item.anchor,item.text)}else if(levelIndex===0){addLI(item.anchor,item.text)}else{while(levelIndex--){levelStack.shift();addEndUL()}addLI(item.anchor,item.text)}});while(levelStack.length){levelStack.shift();addEndUL()}this.toc=[];this.index=0;return result},toc:[],index:0};var MyRenderer=function(_super){__extends(MyRenderer,_super);function MyRenderer(){return _super!==null&&_super.apply(this,arguments)||this}MyRenderer.prototype.heading=function(text,level){var toc=this.options.toc;var _text="";if(toc){_text=escapedText(text)+(""+ ++tocObj.index);tocObj.add(_text,text,level)}return"<h"+level+' id="'+_text+'">\n              '+text+"\n            </h"+level+">"};return MyRenderer}(marked_1.Renderer);marked_1.default.setOptions({renderer:new MyRenderer,highlight:function(code,lang){var hljs=require("highlight.js");var validLanguage=hljs.getLanguage(lang)?lang:"plaintext";return hljs.highlight(validLanguage,code).value},gfm:true,tables:true,breaks:true,pedantic:false,smartLists:true,smartypants:true,xhtml:true});var markdownUtil=function(text){var toc=text.startsWith("[TOC]");return marked_1.default(text.replace("[TOC]",""),{toc:toc},function(error,result){if(error){return"<h2>读取失败！！！</h2>"}if(toc){return tocObj.toHTML()+result}return result})};exports.default=markdownUtil;