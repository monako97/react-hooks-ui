"use strict";var __assign=this&&this.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;Object.defineProperty(o,k2,{enumerable:true,get:function(){return m[k]}})}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});var react_1=__importStar(require("react"));var get_default_theme_1=__importDefault(require("../utils/get-default-theme"));var get_max_zIndex_1=__importDefault(require("../utils/get-max-zIndex"));var isEqual_1=__importDefault(require("lodash/isEqual"));require("./index.css");var _BrowserMockup=function(_a){var keyName=_a.keyName,className=_a.className,_b=_a.theme,theme=_b===void 0?get_default_theme_1.default():_b,_c=_a.fixed,fixed=_c===void 0?true:_c,_d=_a.visible,visible=_d===void 0?true:_d,_e=_a.style,style=_e===void 0?{}:_e,_f=_a.title,title=_f===void 0?"":_f,_g=_a.children,children=_g===void 0?react_1.default.createElement("p",{style:{textAlign:"center",margin:0}},"无内容"):_g;var browser=react_1.useRef(null);var _h=react_1.useState(visible),show=_h[0],setShow=_h[1];var _j=react_1.useState(false),init=_j[0],setInit=_j[1];var _k=react_1.useState(false),isDrag=_k[0],setIsDrag=_k[1];var _l=react_1.useState(false),dragIng=_l[0],setDragIng=_l[1];var _m=react_1.useState({left:0,top:0}),poi=_m[0],setPoi=_m[1];var _o=react_1.useState({left:0,top:0}),offset=_o[0],setOffset=_o[1];var _p=react_1.useState({left:0,top:0}),prePoi=_p[0],setPrePoi=_p[1];var _q=react_1.useState(1),zIndex=_q[0],setZIndex=_q[1];var _r=react_1.useState(react_1.default.isValidElement(children)),isValidElement=_r[0],setIsValidElement=_r[1];var _s=react_1.useState(),fullScreen=_s[0],setFullScreen=_s[1];var _t=react_1.useState({width:(style===null||style===void 0?void 0:style.width)||"fit-content",height:(style===null||style===void 0?void 0:style.height)||"fit-content"}),boxSize=_t[0],setBoxSize=_t[1];var getMaxZInde=function(){var maxZIndex=get_max_zIndex_1.default();setZIndex(maxZIndex+1)};var onMouseDown=react_1.useCallback(function(event){if("ontouchstart"in window&&event.type==="mousedown")return;var _event=window.event||event;var target=_event.srcElement||_event.target||_event.currentTarget;if(target===null||target===void 0?void 0:target.getAttribute("m-drag")){var top_1=_event.pageY||_event.clientY||_event.changedTouches[0].pageY;var left=_event.pageX||_event.clientX||_event.changedTouches[0].pageX;getMaxZInde();setOffset({left:left,top:top_1});setIsDrag(true)}_event=null;target=null},[]);var onMouseMove=react_1.useCallback(function(event){if(isDrag){setDragIng(true);var _event=window.event||event;var pageY=_event.pageY||_event.clientY||_event.changedTouches[0].pageY;var pageX=_event.pageX||_event.clientX||_event.changedTouches[0].pageX;var top_2=pageY-offset.top+prePoi.top;var left=pageX-offset.left+prePoi.left;setPoi({left:left,top:top_2});_event=null}},[isDrag,offset,prePoi]);var onMouseEnd=react_1.useCallback(function(event){if("ontouchstart"in window&&event.type==="mouseup")return;if(isDrag){var _poiEnd=poi;if(_poiEnd.left%2){_poiEnd.left=poi.left+1}if(_poiEnd.top%2){_poiEnd.top=poi.top+1}setPoi(_poiEnd);setPrePoi(_poiEnd);setIsDrag(false);setDragIng(false);setOffset({left:0,top:0})}},[isDrag,poi]);var handleClose=react_1.useCallback(function(){setShow(false)},[]);var handleFullScreen=react_1.useCallback(function(){var _a,_b;if(!fullScreen){var _size={width:(style===null||style===void 0?void 0:style.width)||((_a=browser.current)===null||_a===void 0?void 0:_a.offsetWidth)||"fit-content",height:(style===null||style===void 0?void 0:style.height)||((_b=browser.current)===null||_b===void 0?void 0:_b.offsetHeight)||"fit-content"};if(!isEqual_1.default(boxSize,_size)){setBoxSize(_size)}}setFullScreen(!fullScreen)},[boxSize,fullScreen,style]);react_1.useMemo(function(){setIsValidElement(react_1.default.isValidElement(children))},[children]);react_1.useMemo(function(){if(!visible&&!show)return;setShow(visible)},[visible]);react_1.useEffect(function(){var _a,_b;if(!isValidElement){var containChild=children===browser.current?false:(_a=browser.current)===null||_a===void 0?void 0:_a.contains(children);if(!containChild&&children){(_b=browser.current)===null||_b===void 0?void 0:_b.appendChild(children)}}},[children,isValidElement]);react_1.useEffect(function(){var timers;if(init&&keyName&&visible){if(!(!visible&&!show)){if(show!==null){setShow(0);timers=window.setTimeout(function(){window.clearTimeout(timers);setShow(visible)},300)}else{setShow(visible)}}}return function(){window.clearTimeout(timers)}},[keyName]);react_1.useEffect(function(){var timer;if(init){if(show===false){timer=window.setTimeout(function(){setShow(null);window.clearTimeout(timer)},300)}}else{if(show===false){setShow(null)}setInit(true)}return function(){window.clearTimeout(timer)}},[show]);react_1.useEffect(function(){getMaxZInde()},[]);return show!==null?react_1.default.createElement("div",{"ui-theme":theme,className:"monako__browser--mockup"+(fixed?" monako__browser--mockup--fixed":"")+(className?" "+className:"")+(show?"":" monako__browser--mockup--out"),style:__assign(__assign({},style),{transform:"translate3d("+poi.left+"px, "+poi.top+"px, 1px) perspective(1px) translateZ(0)",zIndex:zIndex,width:boxSize.width,height:boxSize.height,"--transform-drag":"translate3d("+poi.left+"px, "+poi.top+"px, 1px) perspective(1px) translateZ(0)"}),"data-draging":dragIng,"data-fullscreen":fullScreen,onMouseDownCapture:onMouseDown,onMouseMoveCapture:onMouseMove,onMouseUpCapture:onMouseEnd,onMouseOutCapture:onMouseEnd,onTouchStartCapture:onMouseDown,onTouchMoveCapture:onMouseMove,onTouchEndCapture:onMouseEnd,onTouchCancelCapture:onMouseEnd,ref:browser},react_1.default.createElement("div",{className:"monako__browser--mockup--title"},react_1.default.createElement("div",{className:"monako__browser--mockup--title--left"},react_1.default.createElement("i",{className:"monako__browser--mockup--close",onClickCapture:function(){return handleClose()}}),react_1.default.createElement("i",{className:"monako__browser--mockup--minimize"}),react_1.default.createElement("i",{className:"monako__browser--mockup--fullscreen",onClickCapture:function(){return handleFullScreen()}})),react_1.default.createElement("h4",{"m-drag":"true",title:title},title),react_1.default.createElement("div",{className:"monako__browser--mockup--tool"},react_1.default.createElement("i",{className:"copy"}),react_1.default.createElement("i",{className:"theme"}))),isValidElement&&children):null};var BrowserMockup=react_1.default.memo(_BrowserMockup,function(pre,next){return isEqual_1.default(pre,next)});exports.default=BrowserMockup;